<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Question</title>
</head>
<body>
<h1>Question Details</h1>

<div>
  <form th:action="@{/question/update}" method="post">

    <input type="hidden" th:value="${question.questionId}" name="id"/>

    <label for="questionContent">Question Content:</label>
    <input type="text" id="questionContent" name="questionContent" th:value="${question.questionContent}"><br><br>

    <label for="questionType">Question Type:</label>
    <select id="questionType" name="questionType">
      <option value="SINGLE_CHOICE" th:selected="${question.questionType == 'SINGLE_CHOICE'}">SINGLE_CHOICE</option>
      <option value="MULTIPLE_CHOICE" th:selected="${question.questionType == 'MULTIPLE_CHOICE'}">MULTIPLE_CHOICE</option>
      <option value="NUMERIC" th:selected="${question.questionType == 'NUMERIC'}">NUMERIC</option>
    </select><br><br>

    <h3>Answer Options:</h3>
    <ul>
      <li th:each="answer, iterStat : ${question.answerOptions}">
        <label>
          <input type="text" th:value="${answer.content}" name="answerOptions[${iterStat.index}].content"/>
        </label>
        <label>
          <input type="checkbox" th:checked="${answer.isCorrect}" name="answerOptions[${iterStat.index}].isCorrect"/> Correct Answer
        </label>
        <button type="button" th:onclick="'removeAnswerOption(' + ${iterStat.index} + ')'">Remove</button>
      </li>
    </ul>

    <button type="button" onclick="addAnswerOption()">Add Answer Option</button><br><br>

    <input type="submit" value="Update">
  </form>
</div>

<a href="/expert/expert_manage_question">Back to Question List</a>

<script>
  function addAnswerOption() {
      const ul = document.querySelector('ul');
      const index = ul.children.length;

      const li = document.createElement('li');
      li.innerHTML = `
          <label>
              <input type="text" name="answerOptions[${index}].content" placeholder="Answer Content"/>
          </label>
          <label>
              <input type="checkbox" name="answerOptions[${index}].isCorrect"/> Correct Answer
          </label>
          <button type="button" onclick="removeAnswerOption(${index})">Remove</button>
      `;
      ul.appendChild(li);
  }

  function removeAnswerOption(index) {
      const ul = document.querySelector('ul');
      if (ul.children.length > 1) {
          ul.removeChild(ul.children[index]);
      } else {
          alert('At least one answer option must remain.');
      }
  }
</script>

</body>
</html>
